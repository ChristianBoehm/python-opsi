# -*- coding: utf-8 -*-

def updateWIMConfig(self, productId):
	import os.path

	print(self)
	print(self.host_getObjects(type='OpsiDepotserver'))
	print(self.host_getObjects())

	if not productId:
		raise ValueError("Invalid argument {0!r}".format(productId))


	# Check if product exists
	# Get local depot
	# Check if Product on Depot


	depotPath = '/var/lib/opsi/depot'
	productPath = os.path.join(depotPath, productId)
	wimPath = os.path.join(productPath, 'installfiles', 'sources', 'install.wim')

	self.updateWIMConfigFromPath(wimPath, productId)

def updateWIMConfigFromPath(self, path, targetProductId):
	import itertools
	from OPSI.Util.WIM import parseWIM, writeImageInformation

	images = parseWIM(path)

	if targetProductId:
		defaultLanguage = set([image.default_language for image in images if image.default_language])
		if 1 == len(defaultLanguage):
			defaultLanguage = defaultLanguage.pop()
		else:
			if len(defaultLanguage) > 1:
				LOGGER.info("Multiple default languages: {0}".format(defaultLanguage))
				LOGGER.info("Not setting a default.")
			else:
				LOGGER.info("Unable to find a default language.")

			defaultLanguage = None

		writeImageInformation(self, targetProductId, [image.name for image in images],
								list(set(itertools.chain(*[image.languages for image in images if image.languages]))),
								defaultLanguage)
